---
import Layout from '../../layouts/Layout.astro';
import { getApprovedEntries, type GuestbookEntry } from '../../lib/db';
import { formatDate } from '../../lib/format';

let guestbookEntries: GuestbookEntry[] = [];
try {
  guestbookEntries = await getApprovedEntries();
} catch {
  // DB not available during dev without env vars
}
---
<Layout title="guestbook - lewis m.w.">

<details open>
  <summary>guestbook</summary>
  <div class="guestbook-entries">
    {guestbookEntries.map(e => (
      <div class="guestbook-entry">
        <span class="muted">{formatDate(e.createdAt)}</span>
        <span><b set:html={e.url ? `<a href="${e.url}">${e.name}</a>` : e.name} /> {e.message}</span>
      </div>
    ))}
    <div class="guestbook-entry">
      <span></span>
      <span><a href="#" id="sign-guestbook">sign</a><span id="guestbook-status"></span></span>
    </div>
  </div>
</details>

<script>
  import { initGuestbookSign } from '../../scripts/guestbook-sign';
  initGuestbookSign();
</script>
</Layout>
